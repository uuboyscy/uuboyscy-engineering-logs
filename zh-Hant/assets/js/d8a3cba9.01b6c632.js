"use strict";(self.webpackChunkuuboyscy_engineering_logs=self.webpackChunkuuboyscy_engineering_logs||[]).push([[9030],{18840:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>p,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"Orchestration/Prefect/Prefect","title":"Prefect","description":"Register","source":"@site/docs/Orchestration/Prefect/Prefect.md","sourceDirName":"Orchestration/Prefect","slug":"/Orchestration/Prefect/","permalink":"/zh-Hant/docs/Orchestration/Prefect/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"AirFlow","permalink":"/zh-Hant/docs/Orchestration/AirFlow"},"next":{"title":"open","permalink":"/zh-Hant/docs/Python/Basic/open"}}');var r=t(74848),a=t(28453);const d={},i="Prefect",o={},c=[{value:"Register",id:"register",level:2},{value:"Get token",id:"get-token",level:2},{value:"Develop environment",id:"develop-environment",level:2},{value:"Get Start for Your First Flow",id:"get-start-for-your-first-flow",level:2},{value:"Work pool and worker",id:"work-pool-and-worker",level:2},{value:"Block",id:"block",level:2},{value:"Build Deployment",id:"build-deployment",level:2}];function l(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"prefect",children:"Prefect"})}),"\n",(0,r.jsx)(n.h1,{id:"quick-start",children:"Quick start"}),"\n",(0,r.jsx)(n.h2,{id:"register",children:"Register"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://www.prefect.io/",children:"https://www.prefect.io"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"sign-in",src:t(57273).A+"",width:"723",height:"661"})}),"\n",(0,r.jsxs)(n.p,{children:["Login with OTP\n",(0,r.jsx)(n.img,{alt:"otp-email",src:t(9016).A+"",width:"1437",height:"855"})]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"workspace-name",src:t(71539).A+"",width:"691",height:"465"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"login-locally",src:t(53704).A+"",width:"2059",height:"585"})}),"\n",(0,r.jsx)(n.h2,{id:"get-token",children:"Get token"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click ",(0,r.jsx)(n.code,{children:"API keys"}),(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.img,{alt:"api-key",src:t(5246).A+"",width:"317",height:"301"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Click ",(0,r.jsx)(n.code,{children:"Create API key"}),"\n",(0,r.jsx)(n.img,{alt:"create-api-key",src:t(18951).A+"",width:"2068",height:"439"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Determine API key information\n",(0,r.jsx)(n.img,{alt:"name-api-key",src:t(4450).A+"",width:"2070",height:"936"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Login with token\n",(0,r.jsx)(n.img,{alt:"login-command",src:t(93067).A+"",width:"2068",height:"1051"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"develop-environment",children:"Develop environment"}),"\n",(0,r.jsxs)(n.p,{children:["Clone this repository for development",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.a,{href:"https://github.com/uuboyscy/prefect-demo",children:"https://github.com/uuboyscy/prefect-demo"})]}),"\n",(0,r.jsx)(n.p,{children:"Login"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"prefect cloud login --k <your token> \n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"login-command-on-terminal",src:t(32616).A+"",width:"936",height:"62"})}),"\n",(0,r.jsx)(n.h2,{id:"get-start-for-your-first-flow",children:"Get Start for Your First Flow"}),"\n",(0,r.jsxs)(n.p,{children:["Go back to home page and click ",(0,r.jsx)(n.code,{children:"Get started"}),"\n",(0,r.jsx)(n.img,{alt:"home-page",src:t(36803).A+"",width:"2067",height:"510"}),"\n",(0,r.jsx)(n.img,{alt:"auth",src:t(74190).A+"",width:"2068",height:"653"}),"\nYou will find the authentication turn green.",(0,r.jsx)(n.br,{}),"\n","Press ",(0,r.jsx)(n.code,{children:"Next"})," and follow the steps, then you can create the first flow."]}),"\n",(0,r.jsx)(n.h1,{id:"flow-and-task",children:"Flow and task"}),"\n",(0,r.jsx)(n.p,{children:"f_01_quick_start.py"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_01_quick_start")\ndef f_01_quick_start() -> None:\n    df1 = e_data_source_1()\n    df2 = e_data_source_2()\n    df = t_concat(df1, df2)\n    l_db1(df)\n    l_db2(df)\n\nif __name__ == "__main__":\n    f_01_quick_start()\n\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"flow-run-graph",src:t(32637).A+"",width:"2492",height:"978"})}),"\n",(0,r.jsx)(n.p,{children:"f_02_async_task"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_02_async_task")\ndef f_02_async_task() -> None:\n    df1 = e_data_source_1.submit()\n    df2 = e_data_source_2.submit()\n    df = t_concat.submit(\n        df1, df2, wait_for=[df1, df2],\n    )\n    l_db1.submit(df, wait_for=[df])\n    l_db2.submit(df, wait_for=[df])\n\nif __name__ == "__main__":\n    f_02_async_task()\n\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"flow-run-graph-async",src:t(89550).A+"",width:"2476",height:"984"})}),"\n",(0,r.jsx)(n.h1,{id:"register-flow",children:"Register flow"}),"\n",(0,r.jsx)(n.h2,{id:"work-pool-and-worker",children:"Work pool and worker"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create a work Pool ",(0,r.jsx)(n.code,{children:"test"})," and Queue ",(0,r.jsx)(n.code,{children:"docker-deployment"}),"\n",(0,r.jsx)(n.img,{alt:"create-work-pool",src:t(79571).A+"",width:"3344",height:"1036"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Select Process Worker\n",(0,r.jsx)(n.img,{alt:"select-worker",src:t(17435).A+"",width:"3352",height:"2060"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Name the Worker ",(0,r.jsx)(n.code,{children:"test-process"})," and then create it\n",(0,r.jsx)(n.img,{alt:"name-the-worker",src:t(52354).A+"",width:"3354",height:"1006"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Start a Worker\n",(0,r.jsx)(n.img,{alt:"worker-pool-page",src:t(99005).A+"",width:"3350",height:"1588"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'prefect worker start --pool "test-process"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"block",children:"Block"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a GitHub Repository Block\n",(0,r.jsx)(n.img,{alt:"block-page",src:t(64639).A+"",width:"3352",height:"978"}),"\n",(0,r.jsx)(n.img,{alt:"block-list",src:t(92662).A+"",width:"1118",height:"400"})]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"build-deployment",children:"Build Deployment"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",children:'from flows.test.hello_world_flow import hello_world_flow\n\n\nif __name__ == "__main__":\n    from prefect_github import GitHubRepository\n\n    hello_world_flow.from_source(\n        source=GitHubRepository.load("github-repository-uuboyscy"),\n        entrypoint="src/flow/test/hello_world_flow_flow.py:hello_world_flow",\n    ).deploy(\n        name="test-deploy",\n        tags=["test", "project_1"],\n        work_pool_name="test-subproc",\n        cron="1 * * * *"\n    )\n\n'})}),"\n",(0,r.jsx)(n.h1,{id:"schedule",children:"Schedule"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Setup on web GUI\n",(0,r.jsx)(n.img,{alt:"schedule-page",src:t(81813).A+"",width:"2490",height:"1504"})]}),"\n"]}),"\n",(0,r.jsx)(n.h1,{id:"prefect-cloud-status",children:"Prefect cloud status"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.a,{href:"https://prefect.status.io/",children:"https://prefect.status.io"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},5246:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/api-key-57461e0345d667773e99f83c16e95017.png"},74190:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/auth-green-f23664c79cdfb3f868b067dfafa6f09d.png"},92662:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/block-list-dd5de3c5bd236a7b7b936dadba28e715.png"},64639:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/block-page-71a065d0f9e2e51211f7a6cdcda2e7ed.png"},18951:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/create-api-key-0b66df91f7e3b568bdef4482ef563b4b.png"},79571:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/create-work-pool-9dc19c0d5a5a99b15a3f57e98ea98420.png"},89550:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/flow-run-graph-async-b5ee861749e43b170dd298f24dcbced1.png"},32637:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/flow-run-graph-ea2ac196357e2c3191b5a278453aa831.png"},36803:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/home-page-4a1f747ec05e9002cd2229b690e96756.png"},32616:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/login-command-on-terminal-380e05fcc4a18b8792833c3dd73deb01.png"},93067:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/login-command-2ff1606f068f4d655bbaa9c5172812c3.png"},53704:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/login-locally-f667567c7b55733696091d1692ec3d13.png"},4450:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/name-api-key-9b060ac52f152216975e0a8cf3814474.png"},52354:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/name-the-worker-4cb2fabea95d345ea64e0d810f3fcbbb.png"},9016:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/otp-email-b1c891293fb72af555b783d953332f99.png"},81813:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/schedule-page-40bff23ade80b34ba5e18d847c7d4d78.png"},17435:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/select-worker-bbc9b0ed0278b8bd04ac73b84ef6d175.png"},57273:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/sign-in-e32b3e808f92d9549290ae3c3e38bc84.png"},99005:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/worker-pool-page-7e862c145dfa308e2236bf8fce9eccdc.png"},71539:(e,n,t)=>{t.d(n,{A:()=>s});const s=t.p+"assets/images/workspace-name-f1fd60535ab70d3c4189e55202febbd0.png"},28453:(e,n,t)=>{t.d(n,{R:()=>d,x:()=>i});var s=t(96540);const r={},a=s.createContext(r);function d(e){const n=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);