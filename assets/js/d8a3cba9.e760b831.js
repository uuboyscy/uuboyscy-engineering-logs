"use strict";(self.webpackChunkuuboyscy_engineering_logs=self.webpackChunkuuboyscy_engineering_logs||[]).push([[9030],{8840:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>d,toc:()=>l});const d=JSON.parse('{"id":"Orchestration/Prefect/Prefect","title":"Prefect","description":"Register","source":"@site/docs/Orchestration/Prefect/Prefect.md","sourceDirName":"Orchestration/Prefect","slug":"/Orchestration/Prefect/","permalink":"/docs/Orchestration/Prefect/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"AirFlow","permalink":"/docs/Orchestration/AirFlow"},"next":{"title":"Poetry","permalink":"/docs/Python/Virtualenv/Poetry"}}');var s=t(4848),a=t(8453);const r={},i="Prefect",c={},l=[{value:"Register",id:"register",level:2},{value:"Get token",id:"get-token",level:2},{value:"Develop environment",id:"develop-environment",level:2},{value:"Work pool and queue",id:"work-pool-and-queue",level:2},{value:"Agent",id:"agent",level:2},{value:"Runner",id:"runner",level:2},{value:"Block",id:"block",level:2},{value:"Register",id:"register-1",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"prefect",children:"Prefect"})}),"\n",(0,s.jsx)(n.h1,{id:"quick-start",children:"Quick start"}),"\n",(0,s.jsx)(n.h2,{id:"register",children:"Register"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.prefect.io/",children:"https://www.prefect.io"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(4033).A+"",width:"1438",height:"1312"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(5880).A+"",width:"3006",height:"1634"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(1491).A+"",width:"2410",height:"1674"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(9578).A+"",width:"3016",height:"1646"})}),"\n",(0,s.jsx)(n.h2,{id:"get-token",children:"Get token"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(5).A+"",width:"1102",height:"756"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(4092).A+"",width:"3014",height:"1646"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(8023).A+"",width:"3014",height:"1646"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(8526).A+"",width:"3010",height:"1644"})}),"\n",(0,s.jsx)(n.h2,{id:"develop-environment",children:"Develop environment"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/uuboyscy/prefect-demo",children:"https://github.com/uuboyscy/prefect-demo"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"prefect cloud login \\\n\t--key <your token> \\\n\t--workspace <your workspace>\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(3942).A+"",width:"1602",height:"82"})}),"\n",(0,s.jsx)(n.h1,{id:"flow-and-task",children:"Flow and task"}),"\n",(0,s.jsx)(n.p,{children:"f_01_quick_start.py"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_01_quick_start")\ndef f_01_quick_start() -> None:\n    df1 = e_data_source_1()\n    df2 = e_data_source_2()\n    df = t_concat(df1, df2)\n    l_db1(df)\n    l_db2(df)\n\nif __name__ == "__main__":\n    f_01_quick_start()\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(1664).A+"",width:"2492",height:"978"})}),"\n",(0,s.jsx)(n.p,{children:"f_02_async_task"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_02_async_task")\ndef f_02_async_task() -> None:\n    df1 = e_data_source_1.submit()\n    df2 = e_data_source_2.submit()\n    df = t_concat.submit(\n        df1, df2, wait_for=[df1, df2],\n    )\n    l_db1.submit(df, wait_for=[df])\n    l_db2.submit(df, wait_for=[df])\n\nif __name__ == "__main__":\n    f_02_async_task()\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(9946).A+"",width:"2476",height:"984"})}),"\n",(0,s.jsx)(n.h1,{id:"register-flow",children:"Register flow"}),"\n",(0,s.jsx)(n.h2,{id:"work-pool-and-queue",children:"Work pool and queue"}),"\n",(0,s.jsxs)(n.p,{children:["Add work Pool ",(0,s.jsx)(n.code,{children:"test"})," and Queue ",(0,s.jsx)(n.code,{children:"docker-deployment"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(707).A+"",width:"3012",height:"1646"})}),"\n",(0,s.jsx)(n.p,{children:"Select Prefect Agent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(6216).A+"",width:"2992",height:"1644"})}),"\n",(0,s.jsx)(n.p,{children:"Prefect login locally"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"prefect profile create demo\nprefect profile use demo\nprefect cloud login \\\n\t-k pnu_nS3ZKp8OHSbkK5bAbWKxLZEKHz5fVg36sod1 \\\n\t--workspace tir101/default\n"})}),"\n",(0,s.jsx)(n.h2,{id:"agent",children:"Agent"}),"\n",(0,s.jsxs)(n.p,{children:["Run Agent on pool ",(0,s.jsx)(n.code,{children:"test"})," and create a queue ",(0,s.jsx)(n.code,{children:"docker-deplyment"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect agent start --pool "test" --work-queue "docker-deplymet"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"runner",children:"Runner"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t ghcr.io/uuboyscy/prefect-demo/prefect-demo-image .\n"})}),"\n",(0,s.jsx)(n.h2,{id:"block",children:"Block"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(8929).A+"",width:"1118",height:"400"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(5838).A+"",width:"1118",height:"400"})}),"\n",(0,s.jsx)(n.h2,{id:"register-1",children:"Register"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect deployment build \\\n\tsrc/flow/f_01_quick_start.py:f_01_quick_start \\\n\t-n docker \\\n\t-p test \\\n\t-q docker-deplymet \\\n  -sb "github/github-prefect-demo" \\\n  -ib "docker-container/demo-docker-container" \\\n  -a\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect deployment build \\\n\tsrc/flow/f_01_quick_start.py:f_01_quick_start \\\n\t-n docker-local \\\n\t-p test \\\n\t-q docker-local \\\n  -sb "github/github-prefect-demo" \\\n  -a\n'})}),"\n",(0,s.jsx)(n.h1,{id:"schedule",children:"Schedule"}),"\n",(0,s.jsx)(n.p,{children:"Setup on web GUI"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(5831).A+"",width:"2490",height:"1504"})}),"\n",(0,s.jsx)(n.h1,{id:"prefect-cloud-status",children:"Prefect cloud status"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://prefect.status.io/",children:"https://prefect.status.io"})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},5880:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 1-e5ecea454757ad2b838aeb08c30c0f81.png"},9946:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 10-b5ee861749e43b170dd298f24dcbced1.png"},707:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 11-434d8eba00cc0f482b8ef00b932072f5.png"},6216:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 12-a6aba99144fa2f680ebef3dc71c34696.png"},8929:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 13-dd5de3c5bd236a7b7b936dadba28e715.png"},5838:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 14-dd5de3c5bd236a7b7b936dadba28e715.png"},5831:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 15-40bff23ade80b34ba5e18d847c7d4d78.png"},1491:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 2-a79f4fddd621089779b49522c1ebf21f.png"},9578:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 3-f6e128fb3eda1a47232085a6626beea3.png"},5:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 4-810b9979bde9450206b18db8df2a38b6.png"},4092:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 5-bac27ffb52f6da213ffbb7df7d8cd621.png"},8023:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 6-935e1f9ea265d9216e45254c75f4535a.png"},8526:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 7-a66c645b2d3a668740c20ad254095b14.png"},3942:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 8-5e34e30f5af820966b194e63b9202064.png"},1664:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 9-ea2ac196357e2c3191b5a278453aa831.png"},4033:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled-59c007457b76a7e368e5ea33d5ce21e7.png"},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>i});var d=t(6540);const s={},a=d.createContext(s);function r(e){const n=d.useContext(a);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),d.createElement(a.Provider,{value:n},e.children)}}}]);