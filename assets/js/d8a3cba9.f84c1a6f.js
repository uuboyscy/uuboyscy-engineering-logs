"use strict";(self.webpackChunkuuboyscy_engineering_logs=self.webpackChunkuuboyscy_engineering_logs||[]).push([[9030],{18840:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>d,toc:()=>l});const d=JSON.parse('{"id":"Orchestration/Prefect/Prefect","title":"Prefect","description":"Register","source":"@site/docs/Orchestration/Prefect/Prefect.md","sourceDirName":"Orchestration/Prefect","slug":"/Orchestration/Prefect/","permalink":"/docs/Orchestration/Prefect/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"AirFlow","permalink":"/docs/Orchestration/AirFlow"},"next":{"title":"open","permalink":"/docs/Python/Basic/open"}}');var s=t(74848),r=t(28453);const i={},a="Prefect",c={},l=[{value:"Register",id:"register",level:2},{value:"Get token",id:"get-token",level:2},{value:"Develop environment",id:"develop-environment",level:2},{value:"Get Start for Your First Flow",id:"get-start-for-your-first-flow",level:2},{value:"Work pool and queue",id:"work-pool-and-queue",level:2},{value:"Agent",id:"agent",level:2},{value:"Runner",id:"runner",level:2},{value:"Block",id:"block",level:2},{value:"Register",id:"register-1",level:2}];function o(e){const n={a:"a",br:"br",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"prefect",children:"Prefect"})}),"\n",(0,s.jsx)(n.h1,{id:"quick-start",children:"Quick start"}),"\n",(0,s.jsx)(n.h2,{id:"register",children:"Register"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.prefect.io/",children:"https://www.prefect.io"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(4033).A+"",width:"723",height:"661"})}),"\n",(0,s.jsxs)(n.p,{children:["Login with OTP\n",(0,s.jsx)(n.img,{alt:"Untitled",src:t(61491).A+"",width:"1437",height:"855"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(65880).A+"",width:"691",height:"465"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(29578).A+"",width:"2059",height:"585"})}),"\n",(0,s.jsx)(n.h2,{id:"get-token",children:"Get token"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.code,{children:"API keys"}),(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.img,{alt:"Untitled",src:t(5).A+"",width:"317",height:"301"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Click ",(0,s.jsx)(n.code,{children:"Create API key"}),"\n",(0,s.jsx)(n.img,{alt:"Untitled",src:t(64092).A+"",width:"2068",height:"439"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Determine API key information\n",(0,s.jsx)(n.img,{alt:"Untitled",src:t(88023).A+"",width:"2070",height:"936"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Login with token\n",(0,s.jsx)(n.img,{alt:"Untitled",src:t(88526).A+"",width:"2068",height:"1051"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"develop-environment",children:"Develop environment"}),"\n",(0,s.jsxs)(n.p,{children:["Clone this repository for development",(0,s.jsx)(n.br,{}),"\n",(0,s.jsx)(n.a,{href:"https://github.com/uuboyscy/prefect-demo",children:"https://github.com/uuboyscy/prefect-demo"})]}),"\n",(0,s.jsx)(n.p,{children:"Login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"prefect cloud login --k <your token> \n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(61561).A+"",width:"1602",height:"82"})}),"\n",(0,s.jsx)(n.h2,{id:"get-start-for-your-first-flow",children:"Get Start for Your First Flow"}),"\n",(0,s.jsxs)(n.p,{children:["Go back to home page and click ",(0,s.jsx)(n.code,{children:"Get started"}),"\n",(0,s.jsx)(n.img,{alt:"home-page",src:t(36803).A+"",width:"2067",height:"510"}),"\n",(0,s.jsx)(n.img,{alt:"auth",src:t(74190).A+"",width:"2068",height:"653"}),"\nYou will find the authentication turn green.",(0,s.jsx)(n.br,{}),"\n","Press ",(0,s.jsx)(n.code,{children:"Next"})," and follow the steps, then you can create the first flow."]}),"\n",(0,s.jsx)(n.h1,{id:"flow-and-task",children:"Flow and task"}),"\n",(0,s.jsx)(n.p,{children:"f_01_quick_start.py"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_01_quick_start")\ndef f_01_quick_start() -> None:\n    df1 = e_data_source_1()\n    df2 = e_data_source_2()\n    df = t_concat(df1, df2)\n    l_db1(df)\n    l_db2(df)\n\nif __name__ == "__main__":\n    f_01_quick_start()\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(71664).A+"",width:"2492",height:"978"})}),"\n",(0,s.jsx)(n.p,{children:"f_02_async_task"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'import pandas as pd\nfrom prefect import flow, task\n\n@task\ndef e_data_source_1() -> pd.DataFrame:\n    print("Getting df1.")\n    return pd.DataFrame(data=[[1], [2]], columns=["col"])\n\n@task\ndef e_data_source_2() -> pd.DataFrame:\n    print("Getting df2.")\n    return pd.DataFrame(data=[[3], [4]], columns=["col"])\n\n@task\ndef t_concat(df1: pd.DataFrame, df2: pd.DataFrame) -> pd.DataFrame:\n    print("Concating df1 and df2.")\n    return pd.concat([df1, df2]).reset_index(drop=True)\n\n@task\ndef l_db1(df: pd.DataFrame) -> None:\n    print("Loading df to db1.")\n    print(df)\n    print("===============")\n\n@task\ndef l_db2(df: pd.DataFrame) -> None:\n    print("Loading df to db2.")\n    print(df)\n    print("===============")\n\n@flow(name="f_02_async_task")\ndef f_02_async_task() -> None:\n    df1 = e_data_source_1.submit()\n    df2 = e_data_source_2.submit()\n    df = t_concat.submit(\n        df1, df2, wait_for=[df1, df2],\n    )\n    l_db1.submit(df, wait_for=[df])\n    l_db2.submit(df, wait_for=[df])\n\nif __name__ == "__main__":\n    f_02_async_task()\n\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(39946).A+"",width:"2476",height:"984"})}),"\n",(0,s.jsx)(n.h1,{id:"register-flow",children:"Register flow"}),"\n",(0,s.jsx)(n.h2,{id:"work-pool-and-queue",children:"Work pool and queue"}),"\n",(0,s.jsxs)(n.p,{children:["Add work Pool ",(0,s.jsx)(n.code,{children:"test"})," and Queue ",(0,s.jsx)(n.code,{children:"docker-deployment"})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(90707).A+"",width:"3012",height:"1646"})}),"\n",(0,s.jsx)(n.p,{children:"Select Prefect Agent"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(16216).A+"",width:"2992",height:"1644"})}),"\n",(0,s.jsx)(n.p,{children:"Prefect login locally"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"prefect profile create demo\nprefect profile use demo\nprefect cloud login \\\n\t-k pnu_nS3ZKp8OHSbkK5bAbWKxLZEKHz5fVg36sod1 \\\n\t--workspace tir101/default\n"})}),"\n",(0,s.jsx)(n.h2,{id:"agent",children:"Agent"}),"\n",(0,s.jsxs)(n.p,{children:["Run Agent on pool ",(0,s.jsx)(n.code,{children:"test"})," and create a queue ",(0,s.jsx)(n.code,{children:"docker-deplyment"})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect agent start --pool "test" --work-queue "docker-deplymet"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"runner",children:"Runner"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"docker build -t ghcr.io/uuboyscy/prefect-demo/prefect-demo-image .\n"})}),"\n",(0,s.jsx)(n.h2,{id:"block",children:"Block"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(88929).A+"",width:"1118",height:"400"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(5838).A+"",width:"1118",height:"400"})}),"\n",(0,s.jsx)(n.h2,{id:"register-1",children:"Register"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect deployment build \\\n\tsrc/flow/f_01_quick_start.py:f_01_quick_start \\\n\t-n docker \\\n\t-p test \\\n\t-q docker-deplymet \\\n  -sb "github/github-prefect-demo" \\\n  -ib "docker-container/demo-docker-container" \\\n  -a\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'prefect deployment build \\\n\tsrc/flow/f_01_quick_start.py:f_01_quick_start \\\n\t-n docker-local \\\n\t-p test \\\n\t-q docker-local \\\n  -sb "github/github-prefect-demo" \\\n  -a\n'})}),"\n",(0,s.jsx)(n.h1,{id:"schedule",children:"Schedule"}),"\n",(0,s.jsx)(n.p,{children:"Setup on web GUI"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"Untitled",src:t(95831).A+"",width:"2490",height:"1504"})}),"\n",(0,s.jsx)(n.h1,{id:"prefect-cloud-status",children:"Prefect cloud status"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://prefect.status.io/",children:"https://prefect.status.io"})})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},65880:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 1-f1fd60535ab70d3c4189e55202febbd0.png"},39946:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 10-b5ee861749e43b170dd298f24dcbced1.png"},90707:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 11-434d8eba00cc0f482b8ef00b932072f5.png"},16216:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 12-a6aba99144fa2f680ebef3dc71c34696.png"},88929:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 13-dd5de3c5bd236a7b7b936dadba28e715.png"},5838:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 14-dd5de3c5bd236a7b7b936dadba28e715.png"},95831:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 15-40bff23ade80b34ba5e18d847c7d4d78.png"},61491:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 2-b1c891293fb72af555b783d953332f99.png"},29578:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 3-f667567c7b55733696091d1692ec3d13.png"},5:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 4-57461e0345d667773e99f83c16e95017.png"},64092:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 5-0b66df91f7e3b568bdef4482ef563b4b.png"},88023:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 6-9b060ac52f152216975e0a8cf3814474.png"},88526:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 7-2ff1606f068f4d655bbaa9c5172812c3.png"},61561:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 8-5e34e30f5af820966b194e63b9202064.png"},71664:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled 9-ea2ac196357e2c3191b5a278453aa831.png"},4033:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/Untitled-e32b3e808f92d9549290ae3c3e38bc84.png"},74190:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/auth-green-f23664c79cdfb3f868b067dfafa6f09d.png"},36803:(e,n,t)=>{t.d(n,{A:()=>d});const d=t.p+"assets/images/home-page-4a1f747ec05e9002cd2229b690e96756.png"},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>a});var d=t(96540);const s={},r=d.createContext(s);function i(e){const n=d.useContext(r);return d.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),d.createElement(r.Provider,{value:n},e.children)}}}]);